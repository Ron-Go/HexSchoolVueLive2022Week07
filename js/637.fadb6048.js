"use strict";(self["webpackChunkproject2022"]=self["webpackChunkproject2022"]||[]).push([[637],{53:function(e,o,t){t.d(o,{Z:function(){return b}});var a=t(252),n=t(35),s=t(963);const i={"aria-label":"Page navigation example"},l={class:"pagination justify-content-center"},d=(0,a._)("span",{"aria-hidden":"true"},"«",-1),u=[d],c=["onClick"],p=(0,a._)("span",{"aria-hidden":"true"},"»",-1),r=[p];function h(e,o,t,d,p,h){return(0,a.wg)(),(0,a.iD)("nav",i,[(0,a._)("ul",l,[(0,a._)("li",{class:(0,n.C_)(["page-item",{disabled:!t.pagination.has_pre}])},[(0,a._)("a",{class:"page-link",href:"#",onClick:o[0]||(o[0]=(0,s.iM)((o=>e.$emit("send-page",t.pagination.current_page-1)),["prevent"])),"aria-label":"Previous"},u)],2),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.pagination.total_pages,((o,i)=>((0,a.wg)(),(0,a.iD)("li",{class:(0,n.C_)(["page-item",{active:o===t.pagination.current_page}]),key:"page"+i},[(0,a._)("a",{class:"page-link",href:"#",onClick:(0,s.iM)((t=>e.$emit("send-page",o)),["prevent"])},(0,n.zw)(o),9,c)],2)))),128)),(0,a._)("li",{class:(0,n.C_)(["page-item",{disabled:!t.pagination.has_next}])},[(0,a._)("a",{class:"page-link",href:"#",onClick:o[1]||(o[1]=(0,s.iM)((o=>e.$emit("send-page",t.pagination.current_page+1)),["prevent"])),"aria-label":"Next"},r)],2)])])}var m={props:["pagination"],data(){return{}}},_=t(744);const g=(0,_.Z)(m,[["render",h]]);var b=g},637:function(e,o,t){t.r(o),t.d(o,{default:function(){return ce}});var a=t(252),n=t(35);const s={class:"container position-relative",style:{height:"100vh"}},i={class:"row",ref:"couponDom"},l={class:"col-12"},d={class:"text-end my-3"},u={class:"table table-hover"},c=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"優惠名稱"),(0,a._)("th",null,"折扣碼"),(0,a._)("th",null,"折扣百分比"),(0,a._)("th",null,"到期日"),(0,a._)("th",{width:"120px"},"是否啟用"),(0,a._)("th",{width:"120px"},"優惠券管理")])],-1),p={class:"btn-group"},r=["onClick"],h=["onClick"];function m(e,o,t,m,_,g){const b=(0,a.up)("pagination"),C=(0,a.up)("couponModal"),M=(0,a.up)("statusModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",s,[(0,a._)("div",i,[(0,a._)("div",l,[(0,a._)("div",d,[(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=(...e)=>g.addCoupon&&g.addCoupon(...e))},"建立新優惠券")]),(0,a._)("table",u,[c,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.tempCoupons,((e,o)=>((0,a.wg)(),(0,a.iD)("tr",{key:"item"+o},[(0,a._)("td",null,(0,n.zw)(e.title),1),(0,a._)("td",null,(0,n.zw)(e.code),1),(0,a._)("td",null,(0,n.zw)(e.percent)+"%",1),(0,a._)("td",null,(0,n.zw)(e.due_date),1),(0,a._)("td",{class:(0,n.C_)({"text-success":e.is_enabled,"text-danger":!e.is_enabled})},(0,n.zw)(""+(e.is_enabled?"啟用":"未啟用")),3),(0,a._)("td",null,[(0,a._)("div",p,[(0,a._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:o=>g.modifyCoupon(e)},"編輯",8,r),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>g.deleteCoupon(e)},"刪除",8,h)])])])))),128))])])])],512),(0,a.Wm)(b,{pagination:_.pagination,onSendPage:g.getData},null,8,["pagination","onSendPage"])]),(0,a.Wm)(C,{couponMode:_.couponMode,coupon:_.coupon,onConfirm:g.confirmCoupon,onCancel:g.cancel},null,8,["couponMode","coupon","onConfirm","onCancel"]),(0,a.Wm)(M,{ref:"statusModal"},null,512)],64)}var _=t(577),g=t(963);const b={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},C={class:"modal-dialog"},M={class:"modal-content"},v={class:"modal-header"},f={class:"modal-title",id:"exampleModalLabel"},w={key:0},y={key:1},k={key:2},D=(0,a.Uk)("優惠券"),x={class:"modal-body"},$={class:"container-fluid"},z={class:"row"},U={key:0},L={class:"mb-3"},S={for:"title",class:"w-100"},Z=(0,a.Uk)("折扣碼標題 "),q={class:"mb-3"},P={for:"couponCode",class:"w-100"},V=(0,a.Uk)("優惠碼 "),T={class:"mb-3"},j={for:"due_date",class:"w-100"},H=(0,a.Uk)("到期日 "),W={class:"mb-3"},Y={for:"percent",class:"w-100"},I=(0,a.Uk)("折扣百分比 "),K={class:"mb-3"},O={class:"form-check form-switch"},E={class:"form-check-label",for:"enabled"},F={key:1},N=(0,a.Uk)("確認刪除此折扣碼： "),A={class:"text-danger"},B={class:"table"},G=(0,a._)("th",null,"到期日",-1),J=(0,a._)("th",null,"折扣百分比",-1),Q={class:"modal-footer"},R={key:0},X={key:1},ee={key:2};function oe(e,o,t,s,i,l){return(0,a.wg)(),(0,a.iD)("div",b,[(0,a._)("div",C,[(0,a._)("div",M,[(0,a._)("div",v,[(0,a._)("h5",f,[1==t.couponMode?((0,a.wg)(),(0,a.iD)("span",w,"新增")):2==t.couponMode?((0,a.wg)(),(0,a.iD)("span",y,"編輯")):3==t.couponMode?((0,a.wg)(),(0,a.iD)("span",k,"刪除")):(0,a.kq)("",!0),D]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=(0,g.iM)((o=>e.$emit("cancel")),["prevent"]))})]),(0,a._)("div",x,[(0,a._)("div",$,[(0,a._)("div",z,[1==t.couponMode||2==t.couponMode?((0,a.wg)(),(0,a.iD)("div",U,[(0,a._)("div",L,[(0,a._)("label",S,[Z,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[1]||(o[1]=e=>i.tempCoupon.title=e),placeholder:"請輸入coupon標題"},null,512),[[g.nr,i.tempCoupon.title]])])]),(0,a._)("div",q,[(0,a._)("label",P,[V,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"couponCode","onUpdate:modelValue":o[2]||(o[2]=e=>i.tempCoupon.code=e),placeholder:"請輸入coupon優惠碼"},null,512),[[g.nr,i.tempCoupon.code]])])]),(0,a._)("div",T,[(0,a._)("label",j,[H,(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[3]||(o[3]=e=>i.due_date=e),onChange:o[4]||(o[4]=(...e)=>l.changeDate&&l.changeDate(...e))},null,544),[[g.nr,i.due_date]])])]),(0,a._)("div",W,[(0,a._)("label",Y,[I,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"percent","onUpdate:modelValue":o[5]||(o[5]=e=>i.tempCoupon.percent=e),min:"0"},null,512),[[g.nr,i.tempCoupon.percent,void 0,{number:!0}]])])]),(0,a._)("div",K,[(0,a._)("div",O,[(0,a._)("label",E,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox",id:"enabled","true-value":1,"false-value":0,"onUpdate:modelValue":o[6]||(o[6]=e=>i.tempCoupon.is_enabled=e)},null,512),[[g.e8,i.tempCoupon.is_enabled]]),(0,a._)("span",{class:(0,n.C_)(["fw-bold",{"text-success":i.tempCoupon.is_enabled}])},(0,n.zw)(""+(i.tempCoupon.is_enabled?"已啟用":"未啟用")),3)])])])])):3==t.couponMode?((0,a.wg)(),(0,a.iD)("div",F,[(0,a._)("h5",null,[N,(0,a._)("span",A,(0,n.zw)(i.tempCoupon.title),1)]),(0,a._)("table",B,[(0,a._)("tbody",null,[(0,a._)("tr",null,[G,(0,a._)("td",null,(0,n.zw)(i.due_date),1)]),(0,a._)("tr",null,[J,(0,a._)("td",null,(0,n.zw)(i.tempCoupon.percent),1)])])])])):(0,a.kq)("",!0)])])]),(0,a._)("div",Q,[(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:o[7]||(o[7]=(0,g.iM)((o=>e.$emit("cancel")),["prevent"]))},"Close"),(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:o[8]||(o[8]=o=>e.$emit("confirm",i.tempCoupon))},[1==t.couponMode?((0,a.wg)(),(0,a.iD)("span",R,"新增")):2==t.couponMode?((0,a.wg)(),(0,a.iD)("span",X,"編輯")):3==t.couponMode?((0,a.wg)(),(0,a.iD)("span",ee,"刪除")):(0,a.kq)("",!0)])])])])])}var te={props:["coupon","couponMode"],data(){return{tempCoupon:{},due_date:""}},mounted(){},watch:{coupon(){this.tempCoupon={...this.coupon};const e=void 0===this.tempCoupon.due_date?"":new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e},couponMode(){1===this.couponMode&&(this.tempCoupon.is_enabled=0)}},methods:{changeDate(){console.log(this.due_date);const e=Math.floor(new Date(this.due_date)/1e3);this.tempCoupon.due_date=e}}},ae=t(744);const ne=(0,ae.Z)(te,[["render",oe]]);var se=ne,ie=t(364),le=t(53),de={components:{couponModal:se,pagination:le.Z,statusModal:ie.Z},data(){return{tempCoupons:{},coupon:{},pagination:{},couponMode:0,couponModal:{},statusModal:{}}},mounted(){this.couponModal=new _.Modal(document.querySelector("#couponModal")),this.statusModal=new _.Modal(document.querySelector("#statusModal")),this.getData()},methods:{getData(e=1){this.onLoading(),this.axios.get(`https://vue3-course-api.hexschool.io/v2/api/vue2022ron/admin/coupons/?page=${e}`).then((e=>{this.tempCoupons=e.data.coupons,this.pagination=e.data.pagination,this.convertDate(),this.offLoading()})).catch((()=>{this.offLoading()}))},convertDate(){this.tempCoupons.forEach(((e,o)=>{const t=new Date(1e3*e.due_date).toISOString().split("T");[this.tempCoupons[o].due_date]=t}))},addCoupon(){this.couponMode=1,this.coupon={},this.couponModal.show()},modifyCoupon(e){this.couponMode=2;const o={...e};o.due_date=Math.floor(new Date(o.due_date)/1e3),this.coupon=o,this.couponModal.show()},deleteCoupon(e){this.couponMode=3;const o={...e};o.due_date=Math.floor(new Date(o.due_date)/1e3),this.coupon=o,this.couponModal.show()},confirmCoupon(e){1===this.couponMode?this.axios.post("https://vue3-course-api.hexschool.io/v2/api/vue2022ron/admin/coupon",{data:e}).then((e=>{this.getData(),this.coupon={},this.couponMode=0,this.couponModal.hide(),this.returnMessage(e.data.message,1e3)})).catch((e=>{console.dir(e),this.returnMessage(e.data.message,1e3)})):2===this.couponMode?this.axios.put(`https://vue3-course-api.hexschool.io/v2/api/vue2022ron/admin/coupon/${e.id}`,{data:e}).then((e=>{this.getData(this.pagination.current_page),this.coupon={},this.couponMode=0,this.couponModal.hide(),this.returnMessage(e.data.message,1e3)})).catch((e=>{this.returnMessage(e.data.message,1e3)})):3===this.couponMode&&this.axios.delete(`https://vue3-course-api.hexschool.io/v2/api/vue2022ron/admin/coupon/${e.id}`).then((e=>{this.couponModal.hide(),this.returnMessage(e.data.message,1e3),this.couponMode=0,this.getData(this.pagination.current_page)})).catch((e=>{this.manageModal.hide(),this.returnMessage(e.data.message,1e3)}))},cancel(){this.coupon={},this.couponMode=0},onLoading(){this.loader=this.$loading.show({isFullPage:!1,container:this.$refs.couponDom,canCancel:!1,onCancel:this.onCancel,loader:"dots",width:64,height:64,backgroundColor:"#ffffff",opacity:.5})},offLoading(){setTimeout((()=>{this.loader.hide()}),0)},returnMessage(e,o=2e3){setTimeout((()=>{this.$refs.statusModal.textContent=e,this.statusModal.show()}),o)}}};const ue=(0,ae.Z)(de,[["render",m]]);var ce=ue},364:function(e,o,t){t.d(o,{Z:function(){return g}});var a=t(252),n=t(35);const s={class:"modal fade",id:"statusModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},i={class:"modal-dialog"},l={class:"modal-content"},d=(0,a._)("div",{class:"modal-header bg-secondary"},[(0,a._)("h5",{class:"modal-title text-white",id:"exampleModalLabel"},"訊息提示"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),u={class:"modal-body"},c={class:"fs-4"},p=(0,a._)("div",{class:"modal-footer"},[(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉")],-1);function r(e,o,t,r,h,m){return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",i,[(0,a._)("div",l,[d,(0,a._)("div",u,[(0,a._)("p",c,(0,n.zw)(h.textContent),1)]),p])])])}var h={data(){return{textContent:""}}},m=t(744);const _=(0,m.Z)(h,[["render",r]]);var g=_}}]);